<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scale & Chord Visualizer (Responsive)</title>
  <style>
    :root {
      --bg-controls: #E6E6FA;
      --bg-fretboard: #FFFFFF;
      --bg-chords: #FFD1DC;
      --root-color: #FF6961;
      --scale-color: #D8BFD8;
      --fill-yellow: #FFFFE0;
      --fill-blue: #E0FFFF;
      --string-color: #333333;
      --fret-line: #BBBBBB;
      --text-color: #222222;
    }
    html, body { margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif; color: var(--text-color); }
    section { width: 100%; box-sizing: border-box; }
    #controls {
      background: var(--bg-controls);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
    }
    #controls label { display: flex; flex-direction: column; font-size: 0.9rem; }
    #tunings { display: flex; gap: 0.5rem; }
    #tunings label { display: flex; flex-direction: column; font-size: 0.8rem; }
    #fretboard-section { background: var(--bg-fretboard); padding: 1rem; }
    #fretboard { display: block; width: 100%; }
    #chords-section { background: var(--bg-controls); padding: 1rem; }
    #chords { display: flex; flex-direction: column; gap: 1rem; }
    .chord-group h3 { margin: 0 0 0.5rem 0; font-size: 1rem; }
    .chord-group .chord-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .chord-block {
      background: white;
      border-radius: 20px;
      padding: 0.5rem;
      cursor: pointer;
      width: 120px;
      height: 60px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      transition: transform 0.1s;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      overflow: hidden;
    }
    .chord-block:hover { transform: translateY(-2px); }
    .chord-block.active { opacity: 0.8; }
    .chord-name { font-weight: bold; margin-bottom: 0.3rem; font-size: 0.9rem; }
    .chord-notes { font-size: 0.8rem; }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      #controls { flex-direction: column; }
      #tunings { flex-direction: column; }
      .chord-block { width: 100px; height: 55px; border-radius: 20px; }
    }
  </style>

  <style>
    /* Always horizontal scroll for controls and tunings */
    #controls, #tunings {
      flex-wrap: nowrap !important;
      overflow-x: auto !important;
      flex-direction: row !important;
    }
    /* Chord lists as horizontal scrollable rows */
    .chord-list {
      display: flex !important;
      flex-wrap: nowrap !important;
      overflow-x: auto !important;
      gap: 0.5rem;
    }
    .chord-list .chord-block {
      flex: 0 0 auto !important;
    }
  </style>

</head>
<body>
  <section id="controls">
    <label>Root Note<select id="key-select"></select></label>
    <label>Scale<select id="scale-select"></select></label>
    <label>Number of Strings<select id="strings-select"></select></label>
    <div id="tunings"></div>
  </section>
  <section id="fretboard-section"><svg id="fretboard"></svg></section>
  <section id="chords-section">
    <div id="chords">
      <div class="chord-group" id="triads">
        <h3>3-note Chords (Triads)</h3>
        <div class="chord-list"></div>
      </div>
      <div class="chord-group" id="sevenths">
        <h3>4-note Chords: 7th</h3>
        <div class="chord-list"></div>
      </div>
      <div class="chord-group" id="ninths">
        <h3>4-note Chords: 9th</h3>
        <div class="chord-list"></div>
      </div>
      <div class="chord-group" id="elevenths">
        <h3>4-note Chords: 11th</h3>
        <div class="chord-list"></div>
      </div>
    </div>
  </section>

  <script>
    const notes = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
    const scales = {
      'Major Pentatonic': [0,2,4,7,9],
      'Dorian Pentatonic': [0,2,5,7,10],
      'Phrygian Pentatonic': [0,3,5,8,10],
      'Mixolydian Pentatonic': [0,2,5,7,9],
      'Minor (Aeolian) Pentatonic': [0,3,5,7,10],
      'Major (Ionian)': [0,2,4,5,7,9,11],
      'Dorian': [0,2,3,5,7,9,10],
      'Phrygian': [0,1,3,5,7,8,10],
      'Lydian': [0,2,4,6,7,9,11],
      'Mixolydian': [0,2,4,5,7,9,10],
      'Minor (Aeolian)': [0,2,3,5,7,8,10],
      'Locrian': [0,1,3,5,6,8,10],
      'Harmonic Minor': [0,2,3,5,7,8,11],
      'Melodic Minor': [0,2,3,5,7,9,11],
      'Harmonic Major': [0,2,4,5,7,8,11],
      'Melodic Major': [0,2,4,5,7,8,10],
      'Double Harmonic Major': [0,1,4,5,7,8,11]
    };
    const defaultTunings = {
      1:['E'],2:['B','E'],3:['G','B','E'],4:['D','G','B','E'],
      5:['A','D','G','B','E'],6:['E','A','D','G','B','E'],
      7:['B','E','A','D','G','B','E'],8:[
      'E','B','E','A','D','G','B','E'],
      9:['C#','F#','B','E','A','D','G','B','E'],10:['B','E','A','D','G','B','E','A','D','G']
    };
    const keySelect = document.getElementById('key-select');
    const scaleSelect = document.getElementById('scale-select');
    const stringsSelect = document.getElementById('strings-select');
    const tuningsDiv = document.getElementById('tunings');
    const svg = document.getElementById('fretboard');
    const lists = {
      triads: document.querySelector('#triads .chord-list'),
      sevenths: document.querySelector('#sevenths .chord-list'),
      ninths: document.querySelector('#ninths .chord-list'),
      elevenths: document.querySelector('#elevenths .chord-list')
    };
    let state = { key:'E', scale:'Minor (Aeolian)', strings:8, tuning:[], scaleNotes:[], frets:24, activeChord:[] };

    function init() {
      notes.forEach(n=> keySelect.innerHTML+=`<option>${n}</option>`);
      Object.keys(scales).forEach(s=> scaleSelect.innerHTML+=`<option>${s}</option>`);
      for(let i=1;i<=10;i++) stringsSelect.innerHTML+=`<option>${i}</option>`;
      keySelect.value=state.key; scaleSelect.value=state.scale; stringsSelect.value=state.strings;
      keySelect.onchange=update; scaleSelect.onchange=update; stringsSelect.onchange=updateStrings;
      updateStrings();
      window.addEventListener('resize', drawFretboard);
    }

    function updateStrings(){
      state.strings=+stringsSelect.value; tuningsDiv.innerHTML='';
      for(let i=0;i<state.strings;i++){
        const actualIdx=state.strings-1-i;
        const lbl=document.createElement('label'); lbl.textContent=`String ${i+1}`;
        const sel=document.createElement('select'); notes.forEach(n=> sel.innerHTML+=`<option>${n}</option>`);
        sel.value=defaultTunings[state.strings][actualIdx]||'C'; sel.onchange=update;
        lbl.appendChild(sel); tuningsDiv.appendChild(lbl);
      }
      update();
    }

    function update(){
      state.key=keySelect.value; state.scale=scaleSelect.value;
      state.tuning=Array.from(tuningsDiv.querySelectorAll('select')).map(s=>s.value);
      computeScale(); drawFretboard(); renderChords();
    }

    function computeScale(){
      const rootIdx=notes.indexOf(state.key);
      state.scaleNotes=scales[state.scale].map(i=> notes[(rootIdx+i)%12]);
    }

    function drawFretboard(){
      const W = svg.clientWidth;
      // Calculate vertical size adapting to viewport
      const bottomMargin = 20;
      const initialH = W * 0.3;
      const maxH = window.innerHeight - bottomMargin;
      const H = Math.min(initialH, maxH);

      // Dynamic note sizing based on computed H
      const radiusOpen = H * 0.05;
      const radius = H * 0.04;
      const fontSize = `${H * 0.03}px`;
      const totalHeight = H + bottomMargin;
      svg.setAttribute('viewBox', `0 0 ${W} ${totalHeight}`);
      svg.setAttribute('height', totalHeight);

      const S=state.strings, F=state.frets;
      const segment=W/(F+1), margin=segment;
      svg.innerHTML='';

      // fretboard background and markers
      [[-1,0],[11,12],[23,24]].forEach(([a,b])=>{
        const rect=document.createElementNS(svg.namespaceURI,'rect');
        rect.setAttribute('x', margin + a*segment); rect.setAttribute('y', 0);
        rect.setAttribute('width', (b-a)*segment); rect.setAttribute('height', H);
        rect.setAttribute('fill','var(--fill-yellow)'); svg.appendChild(rect);
      });
      [3,5,7,9,15,17,19,21].forEach(n=>{
        const rect=document.createElementNS(svg.namespaceURI,'rect');
        rect.setAttribute('x', margin + (n-1)*segment); rect.setAttribute('y', 0);
        rect.setAttribute('width', segment); rect.setAttribute('height', H);
        rect.setAttribute('fill','var(--fill-blue)'); svg.appendChild(rect);
      });

      // strings with varying thickness (thinnest at top, thickest at bottom)
      const minStrokeWidth = H * 0.005;
      const maxStrokeWidth = H * 0.02;
      state.tuning.forEach((_,i)=>{
        const y = (i+1)*H/(S+1);
        const line = document.createElementNS(svg.namespaceURI,'line');
        line.setAttribute('x1', 0);
        line.setAttribute('y1', y);
        line.setAttribute('x2', W);
        line.setAttribute('y2', y);
        // Calculate stroke width linearly based on string index
        const strokeWidth = S > 1
          ? minStrokeWidth + (i)*(maxStrokeWidth-minStrokeWidth)/(S-1)
          : (minStrokeWidth + maxStrokeWidth)/2;
        line.setAttribute('stroke','var(--string-color)');
        line.setAttribute('stroke-width', strokeWidth);
        svg.appendChild(line);
      });

      // frets and fret numbers
      for(let f=0;f<=F;f++){
        const x=margin+f*segment;
        const line=document.createElementNS(svg.namespaceURI,'line');
        line.setAttribute('x1',x); line.setAttribute('y1',0);
        line.setAttribute('x2',x); line.setAttribute('y2',H);
        line.setAttribute('stroke','var(--fret-line)');
        line.setAttribute('stroke-width', f===0?4:1);
        svg.appendChild(line);
        if(f>0){
          const txt=document.createElementNS(svg.namespaceURI,'text');
          txt.setAttribute('x', x - segment/2); txt.setAttribute('y', H + 14);
          txt.setAttribute('font-size', fontSize);
  txt.setAttribute('text-anchor','middle');
  txt.setAttribute('dominant-baseline','middle'); txt.setAttribute('text-anchor','middle');
          txt.textContent=f; svg.appendChild(txt);
        }
      }

      // notes
      state.tuning.forEach((openNote,i)=>{
        const openIdx=notes.indexOf(openNote);
        const y=(i+1)*H/(S+1);
        for(let f=0; f<=F; f++){
          const note=notes[(openIdx+f)%12];
          if(state.activeChord.length){
            if(!state.activeChord.includes(note)) continue;
          } else {
            if(!state.scaleNotes.includes(note)) continue;
          }
          const cx=margin + (f-0.5)*segment;
          const circle=document.createElementNS(svg.namespaceURI,'circle');
          circle.setAttribute('cx',cx); circle.setAttribute('cy',y);
          circle.setAttribute('r', radius);
          const isRoot=(note===state.key);
          circle.setAttribute('fill', isRoot?'var(--root-color)':'var(--scale-color)');
          circle.setAttribute('stroke','#000'); svg.appendChild(circle);
          const txt=document.createElementNS(svg.namespaceURI,'text');
          txt.setAttribute('x',cx); txt.setAttribute('y',y+4);
          txt.setAttribute('font-size', fontSize);
  txt.setAttribute('text-anchor','middle');
  txt.setAttribute('dominant-baseline','middle'); txt.setAttribute('text-anchor','middle');
          txt.textContent=note; svg.appendChild(txt);
        }
      });
    }

    function renderChords(){
      Object.values(lists).forEach(l=> l.innerHTML='');
      const deg = state.scaleNotes.length;
      state.scaleNotes.forEach((_, i) => {
        [['triads',[i,i+2,i+4],'Triad'],
         ['sevenths',[i,i+2,i+4,i+6],'7th chord'],
         ['ninths',[i,i+2,i+4,i+8],'9th chord'],
         ['elevenths',[i,i+2,i+4,i+10],'11th chord']]
        .forEach(([key,degs,label])=>{
          const notesArr = degs.map(d=>state.scaleNotes[d%deg]);
          const block = document.createElement('div');
          block.className = 'chord-block';
          block.innerHTML = `<div class="chord-name">${label}, deg ${i+1}</div><div class="chord-notes">${notesArr.join(', ')}</div>`;
          block.onclick = ()=>{
            state.activeChord.join()==notesArr.join()? state.activeChord=[]: state.activeChord=notesArr;
            document.querySelectorAll('.chord-block').forEach(el=>el.classList.remove('active'));
            if(state.activeChord.length) block.classList.add('active');
            drawFretboard();
          };
          lists[key].appendChild(block);
        });
      });
    }

    window.onload = init;
  </script>
</body>
</html>
